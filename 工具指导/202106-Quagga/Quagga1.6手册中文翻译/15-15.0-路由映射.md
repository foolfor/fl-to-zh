# 15 路由映射

路由映射提供了一种过滤和/或将操作应用于路由的方法，从而允许将策略应用于路由。

- 路由映射命令：
- 路由映射匹配命令：
- 路由映射设置命令：
- 路由映射呼叫命令：
- 路由映射退出动作命令：
- 路由映射示例：

路由映射是路由映射条目的有序列表。每个条目最多可以指定四个不同的子句集：

```shell
'Matching Policy'
```

这指定了隐含的策略，如果`Matching Conditions`满足或不满足，以及要采取的路由映射的哪些行动，如果有的话。两种可能是：

- `permit`: 如果条目匹配，则执行`Set Actions`。然后完成处理路由映射，允许路由，除非`Exit Action`表示否则。
- `deny`：如果条目匹配，则完成对路由映射的处理并拒绝路由（返回 `deny`）。

这`Matching Policy`被指定为定义路由映射中有序条目的命令的一部分。见下文。

```shell
'Matching Conditions'
```

路由映射条目可以可选地指定一个或多个条件，如果要进一步考虑该条目，则必须匹配这些条件，如匹配策略所管理。如果路由映射条目未明确指定任何匹配条件，则它始终匹配。

```shell
'Set Actions'
```

一个路由映射条目可以可选地指定一个或多个`Set Actions`设置或修改路由的属性。

```shell
'Call Action'
```

在任何之后调用另一个路由映射`Set Actions`已经执行。如果调用的路由映射返回`deny`然后路由映射的处理完成并且路由被拒绝，不管`Matching Policy`或者`Exit Policy`。如果被调用的路由映射返回`permit`， 然后`Matching Policy`和`Exit Policy`像往常一样管理进一步的行为。

```shell
'Exit Policy'
```

一个条目可以选择指定一个替代的`Exit Policy`如果条目匹配，则采用，而不是退出路由映射并允许路由的正常策略。两种可能是：

- `next`：继续处理路由映射条目。
- `goto N`：跳转到第一个路由映射条目，其在路由映射中的顺序为 >= N。不允许跳转到前一个条目。

如果没有条目匹配，路由映射的默认操作是拒绝。即路由映射本质上具有作为其最后一个条目的空`deny`条目，匹配所有路由。要改变这种行为，必须指定一个空的`permit`条目作为路由映射中的最后一个条目。

总结以上几点：

|        | Match  | No Match |
| ------ | ------ | -------- |
| Permit | action | cont     |
| Deny   | deny   | cont     |

```shell
'action'
```

- 应用*set*语句
- 如果*call*存在，调用指定路由映射。如果返回一个`deny`, 完成处理并返回`deny`。
- 如果`Exit Policy`是*下一个*，转到下一个路由映射条目
- 如果`Exit Policy`是*goto*，转到列表中顺序为 >= 给定顺序的第一个条目。
- 完成对路由映射的处理并允许路由。

```shell
'deny'
```

- 路由被路由映射拒绝（返回`deny`）。

```shell
'cont'
```

- 转到下一个路由映射条目